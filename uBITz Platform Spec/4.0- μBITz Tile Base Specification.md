# μBITz Tile Base Specification v1.0 (Draft)

**Status:** Draft (Normative, unless otherwise noted)  
**Date:** 2025  
**Applies to:** All μBITz Tiles (video, audio, I/O, storage, etc.)  
**Depends on:**  
- μBITz Platform Specification v1.0  
- μBITz Dock Specification v1.0 — Part 0 (Overview) & Part 1 (Core Logical Specification)  
- μBITz Host Specification v1.0 (for interrupt routing and enumeration assumptions)  
- μBITz Bank Specification v1.0 (for memory timing assumptions, where applicable)

---

# Part 0 — Overview, Rationale, and Scope

## 0.1 What is a μBITz Tile?

A **μBITz Tile** is a μBITz-compliant peripheral device designed to attach to a μBITz Dock and provide one or more logical functions (video, sound, I/O, storage, etc.) to the Host CPU.

From the Host’s point of view, a Tile is:

- A finite set of **register and/or memory windows** in the μBITz address space.
- A finite set of **interrupt sources**, routed through the Dock’s interrupt fabric.
- An optional set of **descriptor and configuration structures** exposed via the Dock’s enumeration mechanism.

A Tile:

- **MUST NOT** be a bus master. All bus activity is initiated by the Host.  
- **MUST** obey the cycle, READY, and interrupt semantics defined by the Dock Core Logical Specification.  
- **MUST** be electrically and logically safe in the presence of other Tiles on the same Dock.

This specification defines the **minimum contract** every Tile must meet, independent of its physical implementation (Serial, Parallel) or internal architecture (FPGA, MCU, ASIC, etc.).

---

## 0.2 Goals and non-goals

### 0.2.1 Goals

The Tile Base spec aims to:

- Define a **single, simple mental model** for all Tiles:
  - “A Tile = windows + registers + interrupts + descriptor.”
- Provide a **hard safety floor**:
  - A misbehaving Tile should not break the backplane or other Tiles.
- Make Tiles **stackable and swappable**:
  - Any Host that understands the Dock and Core model can discover and use any compliant Tile.
- Make room for **Versatile Tile classes** (Media/IO) and other specializations without redefining the base rules.

### 0.2.2 Non-goals

This specification does **not**:

- Define device-specific behavior (e.g., VDP, Sound, HID). Those live in each device’s own Tile spec.
- Define internal implementation details (state machines, pipelines, micro-architectures).
- Replace or override the Dock Core Logical Specification; it only constrains how Tiles behave *within* that model.

---

## 0.3 Relationship to other specifications

- The **μBITz Platform Specification** defines the overall system, roles of Host/Bank/Dock/Tiles, and versioning.
- The **Dock Core Logical Specification** defines:
  - Cycle semantics, READY behavior, address decoding, and interrupt routing.  
  - This Tile Base spec **MUST NOT** contradict those rules; in any conflict, the Core spec prevails.
- The **Versatile Tile Classes — Overview Specification** describes recommended architectures for Media and IO Tiles:
  - Tiles based on those classes **MUST** satisfy this Tile Base spec first, then the additional class-specific rules.
- Device-specific specs (e.g., **VDP Tile**, **Sound Processor Tile**) extend this Tile Base spec with:
  - Concrete register maps, memory layouts, and timing/interrupt behavior.

---

# Part 1 — Tile Lifecycle and Behavior

## 1.1 Reset and power-up behavior

Unless otherwise specified by the Dock profile:

- A Tile **MUST** power up in a **safe, non-driving state**:
  - Data bus drivers **MUST** be tri-stated except when actively selected during a valid cycle.
  - Any open-drain interrupt outputs **MUST** be deasserted.
- After system reset is released:
  - A Tile **MUST** present a deterministic, documented reset state for:
    - All user-visible registers.
    - All interrupt status bits.
    - Any Tile configuration state that affects bus behavior.
- A Tile **MUST NOT** drive the data bus or assert interrupts before:
  - Power rails are within their specified ranges; and
  - Any reset signal from the Dock has been deasserted for the required minimum time.

Device-specific Tile specs **MUST** document:
- Reset state of all registers.
- Any required delay before the Tile is considered “ready” (e.g., PLL lock time).

---

## 1.2 Enumeration and descriptors

Tiles participate in μBITz enumeration via the Dock’s descriptor mechanism.

Unless explicitly exempted by the relevant Dock profile (e.g., certain Minimal configurations):

- Every Tile **MUST** expose a **Tile Descriptor** accessible via the Dock’s enumeration bus
- A Tile Descriptor **MUST** include at least:
  - A **Tile Class** code (video, audio, IO, storage, custom, etc.).
  - A **Vendor ID** and **Product ID**.
  - A **Revision** / firmware version.
  - **Address and Data Bus Width**
  - **Interrupt acknowledgement mode**
  - **Interrupt Channels**
- A Tile **MAY** expose additional descriptors (e.g., human-readable name, feature flags) as defined by higher-level Tile-class specs.

Tiles:

- **MUST NOT** require out-of-band configuration (e.g., hidden DIP switches) in order to be enumerable.
- **MUST NOT** assume a particular Host CPU family; all Host-specific personality is handled at the Host side.

---

## 1.3 Window ownership and address decoding

Tiles interact with the Host exclusively through Core-defined **windows**.

- A Tile **MUST** only respond to cycles targeting:
  - Windows explicitly assigned to that Tile by configuration, or
  - Windows advertised as belonging to that Tile in its descriptor (for static mappings).
- A Tile **MUST NOT**:
  - Decode or respond to addresses outside its assigned windows.
  - Monitor or rely on “hidden” bus activity on unrelated windows.
- When multiple Tiles are present:
  - Windows assigned to a Tile **MUST NOT** overlap with windows assigned to another Tile in a way that causes two devices to drive the bus simultaneously.
  - The Dock and Host are responsible for ensuring non-overlapping assignments; however, Tiles **MUST** be designed so that if such an overlap occurs accidentally, the electrical behavior is still as benign as possible (e.g., tri-stated unless fully selected).

Device-specific Tile specs **MUST** state:

- The minimum and maximum window sizes they can support.
- Any alignment requirements (e.g., window base must be 256-byte aligned).
- Whether their windows are fixed or reconfigurable.

---

## 1.4 Register model

Within each assigned window, a Tile exposes a register or memory model to the Host.

All Tiles:

- **MUST** implement a **byte-addressed** or **word-addressed** register model consistent with the Dock Core Logical Specification and the Host’s DataBusWidth.
- **MUST** document:
  - Register layout (offsets, names, access types).
  - Reset values.
  - Side effects on read and write.
- **MUST NOT** rely on undefined behavior for:
  - Partial writes (e.g., byte write to a 32-bit register) unless explicitly documented.
  - Read-modify-write cycles that are not atomic.

Tiles:

- **MAY** expose:
  - Memory-like windows (e.g., VRAM).
  - FIFO registers.
  - Indirect addressing schemes (index + data register pairs).
- **MUST** ensure that all externally observable behavior can be described in terms of:
  - Reads and writes to documented
## 1.4 Register model

Within each assigned window, a Tile exposes a register or memory model to the Host.

All Tiles:

- **MUST** implement a **byte-addressed** or **word-addressed** register model consistent with the Dock Core Logical Specification and the Host’s DataBusWidth.
- **MUST** document:
  - Register layout (offsets, names, access types).
  - Reset values.
  - Side effects on read and write.
- **MUST NOT** rely on undefined behavior for:
  - Partial writes (e.g., byte write to a 32-bit register) unless explicitly documented.
  - Read-modify-write cycles that are not atomic.

Tiles:

- **MAY** expose:
  - Memory-like windows (e.g., VRAM).
  - FIFO registers.
  - Indirect addressing schemes (index + data register pairs).
- **MUST** ensure that all externally observable behavior can be described in terms of:
  - Reads and writes to documented registers/memory locations.
  - Dock interrupts and READY behavior.

---

## 1.5 Interrupts

Tiles may raise interrupts via the Dock’s interrupt fabric.

All Tiles that generate interrupts:

- **MUST** use only the interrupt lines allocated to them by configuration or by a fixed mapping defined in the Dock profile.
- **MUST** provide at least one **status register** accessible via the Tile’s windows that allows the Host to:
  - Determine the cause of the interrupt.
  - Clear or mask individual interrupt sources.
- **MUST** deassert interrupts deterministically once the Host has:
  - Performed the documented sequence of status reads and clears; or
  - Written the documented interrupt-clear register(s).

The form of interrupt signaling:

- **MUST** follow the Dock Core definition (e.g., level vs edge semantics).
- **MUST NOT** rely on Host-specific interrupt modes (e.g., Z80 IM2) beyond what is guaranteed by the Host Specification.

Tiles:

- **MAY** support multiple interrupt sources multiplexed onto one or more physical lines.
- **MAY** expose a “summary” interrupt in addition to per-source mask bits.

---

## 1.6 READY and timing behavior

Tiles may stretch cycles via the Dock’s READY mechanism.

- A Tile **MUST** comply with the READY semantics defined by the Dock Core Logical Specification:
  - It may extend a cycle only by the documented method (e.g., asserting/deasserting READY at specific phases).
  - It **MUST** release READY within a bounded time once the requested operation completes.
- A Tile **MAY** document:
  - Its worst-case READY extension for specific operations (e.g., “VRAM read: up to N cycles”).
- A Tile **MUST NOT**:
  - Hold READY indefinitely under normal operation.
  - Violate the Dock’s timing rules for set-up/hold of READY relative to other signals.

Device-specific Tile specs **SHOULD** provide timing diagrams for:

- Typical read/write operations.
- Worst-case operations that stretch READY (e.g., DMA-triggered reads, sample-buffer access).

---

# Part 2 — Electrical Behavior and Dock Interaction

## 2.1 Bus driving rules

All Tiles:

- **MUST** treat the data bus as shared:
  - Only drive the bus when:
    - The Tile is selected for the current cycle; and
    - The direction of the cycle requires the Tile to drive (e.g., read from Tile).
- **MUST** tri-state their data bus drivers:
  - At all other times, including:
    - Reset.
    - Idle cycles.
    - Cycles addressed to other devices/windows.
- **MUST NOT**:
  - Use internal pull-ups/downs on the shared data bus unless explicitly allowed by the Dock profile.
  - Drive any Dock lines that are defined as Host-only outputs (as per Dock profile pin maps).

Control and address lines:

- Tiles **MUST** treat all Dock control and address signals as inputs only, unless a specific profile explicitly allows Tile-side driving of a given signal (e.g., open-drain interrupt lines).

---

## 2.2 Power and current

- Each Tile **MUST** conform to:
  - The voltage rails and current limits defined by the relevant Dock profile (Serial/Parallel).
- Tiles **MUST**:
  - Include appropriate local decoupling on all power rails.
  - Avoid inrush currents that exceed Dock guidelines at power-on, or document any special requirements.
- Tiles **MUST NOT**:
  - Draw more current from any rail than the Dock profile guarantees without explicit negotiation or documentation in the Tile spec.
  - Back-drive power into the Dock rails.

Device-specific Tile specs **SHOULD** provide:

- Typical and worst-case current draw per rail.
- Any special sequencing requirements (e.g., core vs I/O rails).

---

## 2.3 Clocking

This spec does not impose a specific internal clock architecture, but:

- Tiles **MUST** tolerate the Host/Dock base clock range specified by the relevant profiles.
- If a Tile depends on external clocks from the Dock:
  - It **MUST** document the required clock frequencies, tolerances, and jitter.
- Tiles with internal PLLs or clock generators:
  - **MUST** ensure that all externally observable timing (READY, interrupt latency, etc.) remains within the bounds promised by this and the device-specific Tile spec.

---

# Part 3 — Profile-Specific Considerations

This section is informative; actual electrical and timing limits are defined in each Dock profile (Serial/Parallel/Minimal). Tile designers **SHOULD** read the appropriate profile specification before finalizing a design.

## 3.1 Serial profile (Framed LVDS on M.2 slots)

- Tiles using the Serial profile:
  - **MUST** implement the framed link behavior defined in Dock Part 2.
  - **MUST** assume that all bus interactions are serialized; they must not depend on parallel bus side-effects.

## 3.2 Parallel profile (PCIe x16 slots)

- Tiles using the Parallel profile:
  - **MUST** follow the PCIe x16-based pin map and signal definitions in Dock Part 3.
  - **SHOULD** assume short, local backplanes with sub-GHz signaling and respect any skew/length recommendations.

## 3.3 Minimal profile (MCU bridge)

- In Minimal builds:
  - Some enumeration behavior may be simplified or hard-wired by the MCU bridge.  
  - Tiles **MAY** be integrated into the MCU bridge (i.e., not physically separate boards), but their logical behavior **MUST** still follow this Tile Base spec.

---

# Part 4 — Compliance

A device may claim to be a **μBITz Tile 1.0** if and only if:

- It **implements the μBITz Tile Base Specification v1.0**, and
- It **implements at least one Dock profile** (Serial/Parallel/Minimal) as specified in the corresponding Dock profile document, and
- It complies with any additional rules in its **device-specific Tile specification** (e.g., VDP Tile, Sound Processor Tile), and
- It passes the μBITz Tile conformance tests (as defined in the relevant test annex).

Conformance statements **SHOULD** include:

- Tile Class (video, audio, IO, etc.).
- Supported Dock profiles.
- Supported Host AddressBusWidth/DataBusWidth combinations.
- Reference to the specific Tile spec and revision implemented (e.g., “μBITz VDP Tile Specification v1.0”).

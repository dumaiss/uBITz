## μBITz Platform I/O Bus Architecture


---

# Part 0 — Overview, Rationale, and Scope

## 0.1 What is μBITz Dock?

μBITz Dock is a small, modular I/O-only expansion interconnect for multi-platform retro-modern systems. It standardizes a simple, Z80-like I/O model (windowed, register-file semantics) while allowing multiple physical realizations (“profiles”) that fit different build styles. It implements function-routing (as opposed to geographic or address routing). The CPU board implements a complete platform (C64, Apple II, ZX Spectrum, etc.) while peripheral cards provide standardized devices (video, sound, storage, I/O) that work across platforms.

Across all profiles, software sees **the same logical device model**: functions (windows), registers, interrupts, and enumeration.

**Key Design Principles:**
- One CPU card
- Up to 4 peripheral cards
- I²C enumeration with EEPROM-based configuration
- Function-based addressing
- Interrupt routing with CPU-defined mapping

## 0.2 Design Philosophy Statement

Design Principle: Appropriate Complexity

μBITz Dock inherits the Platform design philosophy: retro-friendly, hobbyist-scale, non-safety-critical

## 0.3 Profiles at a glance

| Part | Profile      | Connector / Physical           | Width Exposure                           | Slots | Encoding / Transfer | Notes                                                         |
| ---- | ------------ | ------------------------------ | ---------------------------------------- | ----- | ------------------- | ------------------------------------------------------------- |
| 1    | **Core**     | (logical only)                 | A: 8/16/32; D: 8/16/32 (declared by CPU) | —     | —                   | Windows/registers, interrupts, descriptors                    |
| 2    | **Parallel** | PCIe x16 (repurposed)          | **Always** A[31:0], D[31:0] on connector | 1–4*  | Parallel bus        | Keep PCIe PWR/GND pin roles; 3.3 V + optional 5 V; no 12 V    |
| 3    | **Minimal**  | CPU↔backplane: Parallel header | As per Parallel at CPU boundary          | n/a   | Internal bridge     | MCU side serializes via reference bridge; optional CPU EEPROM |
| 4    | **Ref Impl** | Reference design               | Matches Part 2                           | n/a   | Matches Part 2      | HDL/firmware, tools, examples                                 |
* ** The Dock specification provides for 4 physical Tile slots, + 1 virtual slot for Dock services (eg: RTC, USB Hub, Power management, etc...).
## 0.4 Normative language

Keywords **MUST**, **SHOULD**, **MAY**, **MUST NOT**, **SHOULD NOT** are normative. Informative notes are labeled “Note”.

## 0.5 Compliance model (overview)

- **CPU compliance**: publishes valid descriptor (widths, IntAckMode). Handles `/READY`. In Mode-2, uses internal I register; expects 8-bit vector index on ack.
- **Device compliance**: implements function windows and registers; supports Mode-2 by supplying an 8-bit vector index when its INT channel is acknowledged; otherwise returns 0xFF.
- **Backplane compliance (Parallel/Minimal)**: exposes full `A[AddressBusWidth-1:0]`, `D[DataBusWidth-1:0]`; for v1.x, `AddressBusWidth` is 8/16/32.; provides `/RD`, `/WR`, `/READY`, `/INT_CH[1:0]`, `/NMI_CH`, `/INT_ACK`, I²C, `/RESET`. Minimal includes the **parallel↔serial bridge** to the MCU.
- **Reference bridge compliance (Minimal)**: implements the specified frame format, flow control, and timing between the parallel side and the MCU.

## 0.6 Versioning & compatibility

- **v1.0** is the first public spec. Minor revisions (v1.0.x) will not change pin maps or logical semantics. Major revisions may extend fields, add channels, or new profiles but will preserve existing behavior whenever possible.

## 0.7 Safety & handling

- Not for safety-critical use. Observe ESD precautions. Unless a profile explicitly states otherwise, **power down before card insertion/removal**. 

## 0.8 Key terms

- **Window**: 16-entry function space selected by the high address nibble.
- **Register**: 8-bit address within the window (low nibble + width).
- **CPU card**: Host processor board that declares widths and interrupt ack mode.
- **Device card**: Peripheral implementing one or more functions.
- **Backplane**: Physical interposer providing power, signals, slots, and enumeration.
- **Vector index**: 8-bit value supplied by the device during Mode-2 ack.
- **Vector base**: High byte from the CPU’s I register; not provided by devices.
- **/INT_ACK**: Active-low lines used to acknowledge the corresponding **/INT_CH**.

## 0.9 How to use this document

1. **Read Part 0** (this section) to decide which profile fits your build.
2. **Implement Part 1** (Core) in your firmware and device register maps.
3. **Pick one physical Part** (2: Parallel, or 3: Minimal) and follow its pin map, timing, and power rules.
4. For a working baseline, study **Part 4** (Reference Implementation).

## 0.10 Bank Selection and Memory-Space Decode

- In the default model, `A[]` on the μBITz bus is the CPU/canonical address (not a pre-translated offset); the Dock decodes target selection from this address and cycle qualifiers.

- During each bus cycle, the Dock samples `A[]`, `/MREQ`, `/IORQ`, and `R/W_`.
- The Dock uses the CPU Descriptor memory-map to determine the target:
  - If the cycle targets the Bank memory region, assert `/CS` for the Bank slot.
  - Otherwise assert `/CS` for the selected Tile slot (if applicable).
- When (and only when) the Bank slot is selected **and** it is a memory cycle (`/MREQ = 0`, `/IORQ = 1`):
  - The Dock **SHALL** drive `/MEM0_CS` and `/MEM1_CS` to indicate RAM/ROM0/ROM1/ROM2 (active-low truth table below).
- Otherwise (not Bank selected **OR** not a memory cycle):
  - The Dock **SHALL** drive `/MEM0_CS = /MEM1_CS = 1` (inactive).
- The Dock **SHALL** assert the Bank slot `/CS` only for Bank-targeting memory cycles.
- When Bank `/CS` is asserted, `/MEM0_CS` and `/MEM1_CS` **SHALL** be valid and stable for the duration of the cycle.
- When the Bank is not selected, the Dock **SHALL** drive `/MEM0_CS=/MEM1_CS=1` (inactive).

Active-low table:

- RAM:  `/MEM0_CS = 0`, `/MEM1_CS = 1`
- ROM0: `/MEM0_CS = 1`, `/MEM1_CS = 0`
- ROM1: `/MEM0_CS = 0`, `/MEM1_CS = 0`
- ROM2: `/MEM0_CS = 1`, `/MEM1_CS = 1`

The Dock does not perform address translation in the default model.
